## Erste Datenanalysen in R

*dies sage ich im Video*

Was machen wir in dieser Einheit? Noch mehr Lust bekommen auf Arbeit mit Daten. Daher starten wir direkt mit einem Anwendungsbeispiel. Hier geht es darum große Konzepte kennenzulernen und so Details zu wie das genau alles implementiert wird, die im Kursverlauf kommen, besser einordnen zu können.

gern an einem eigenen datensatz nachmachen

Agenda der Einheit
0. Einlesen und Prep 
1. Mittels Visualisierung die Daten erschließen
2. Kompakte statistische Kennzahlen erstellen
3. Inferenz: Teststatistik erstellen und interpretieren

Datensatz von TidyTuesday vorstellen

https://de.wikipedia.org/wiki/Recycling-Code

https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-01-26


### Vorbereitung
``` {r Pakete laden, echo=FALSE}

library(tidyverse)
library(janitor)
library(countrycode)

```



``` {r einlesen}

plastics <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-01-26/plastics.csv')


```


``` {r Daten Struktur}

str(plastics)

```

``` {r Daten Struktur 2}
head(plastics)
tail(plastics)
```



``` {r Daten Struktur 3}
plastics %>%
        tabyl(country, year) %>%
          janitor::adorn_rounding(digits=2) %>%
          arrange(desc(`2019`))
```


``` {r Daten prep 1 }

#@ Nina gern übernehmen...

# Country name cleaning: 
  #United Kingdom of Great Britain & Northern Ireland ssowie für die USA
plastics_prep <- plastics %>%
  # nur 2019 weil 2020 wegen der Pandemie ein nicht repräsentatives Jahr ist
  filter(year==2019) %>%
  mutate(country = str_replace(country, "United Kingdom of Great Britain & Northern Ireland", "United Kingdom"),
         country = str_replace(country, "United States of America", "United States")) %>%
  #Continent und country code anspielen
  mutate(continent = countrycode::countrycode(country, origin = "country.name", destination = "continent"),
         countrycode = countrycode::countrycode(country, origin = "country.name", destination = "iso3c"))

``` 

``` {r Datensatz 1 community}


community<- plastics_prep %>%
  select(country, year, num_events, volunteers, continent, countrycode) %>%
  group_by(country, year) %>%
  filter(row_number()==1)

``` 

``` {r Datensatz 2 audit firm}

audit_firm<- plastics_prep %>%
  select(country, year, parent_company, grand_total, continent, countrycode) %>%
  # grandtotal zeilen löschen - ist schon in einer Spalte erfasst
  filter(parent_company!="Grand Total")

``` 

``` {r Datensatz 2 audit plastik}

audit_plastic<- plastics_prep %>%
  
  # nur grandtotal zeile behalten
  filter(parent_company=="Grand Total") %>%
  select(-c(parent_company, num_events, volunteers))


``` 

```{r empty-loschen, exercise=TRUE}

```

```{r empty-loschen}

audit_plastic<- audit_plastic %>%
  select(-empty)

```

### 1 Visuelle Exploration 


*dies sage ich im Video*

- Wichtig erst viz dann statistik!
- Ein Q&A mit den Daten machen - mit dem Wissen der Aktion, welche Fragen würdet ihr den Daten stellen wollen?
- Meine Ideen:

Community Perspektive  
  - Wie viele Teilnehmer? Insgesamt und nach Ländern?
  - Wie viele Events?

Activism Perspektive
  - Wievele Firmen? Insgesamt und nach Ländern?
  - 
  
- layered grammar
- r4ds inspirierte Vorstellung von ggplot2

https://github.com/allisonhorst/stats-illustrations/

Cedrics Blog verlinken


```{r grahik1, echo=FALSE}

community %>%
  ggplot(aes(continent, volunteers))

```


```{r grahik2, echo=FALSE}

community %>%
  ggplot(aes(volunteers, continent)) +
  geom_bar(stat="identity")

```


```{r grahik3, echo=FALSE}

community %>%
  ggplot(aes(volunteers, reorder(continent, volunteers))) +
  geom_bar(stat="identity", position="dodge") +
  labs(title = "Beteiligung an 'Break free from Plastik' ..." ,
      subtitle= "... unterscheidet sich nach Kontinent",
      x = "Anzahl Freiwilliger",
      y = "Kontinent") +
  theme_minimal()
  
```


```{r grahik4 anderes geom, echo=FALSE}

community %>%
  ggplot(aes(reorder(continent, volunteers),volunteers)) +
  geom_jitter(width = .1, alpha=0.75) +
  labs(title = "Beteiligung an 'Break free from Plastik' ..." ,
       subtitle= "... unterscheidet sich nach Kontinent.",
       x = "Anzahl Freiwilliger",
       y = "Kontinent") +
  theme_minimal()

```


```{r grahik5 outlier ausklammern anderes geom, echo=FALSE}

community %>%
  filter(iso_a3!="TWN") %>%
  ggplot(aes(reorder(continent, volunteers), volunteers)) +
  geom_jitter(width = .2, alpha=0.6, size=3) +
  labs(title = "Beteiligung an 'Break free from Plastik' ..." ,
       subtitle= "... unterscheidet sich nach Kontinent.",
       x = "Anzahl Freiwilliger",
       y = "Kontinent") +
  theme_minimal()

```

```{r graph übung, echo=FALSE}
#Diese Graphik für firmen perspektive oder Plastik audit perspektive erstellen

```



### Exploration mit statistischen Kennzahlen

https://github.com/allisonhorst/bren-phd-workshop-r-materials/blob/master/day_4_r_materials/day_4_part_2_key.R

dplyr::group_by + summarize - a powerful combo

```{r Kurz Statistik}
summary(plastics)
```


```{r Gruppieren Statistik und Statistik ausgeben}


```


```{r audit Perspektive: Gruppieren Statistik und Statistik für top 3 ausgeben}


```


### Teststatistik 

*Sage ich im Video*

- Spirit: Evaluation
- Achtung - hier bewegen wir uns auf theoretisch gesehen auf neuem Territorium: Inferenzstatistik: wir schließen von unserer Stichprobe auf die Grundgesamtheit. Die Programmierung ist simple, damit es auch von der Interpretation her sinnvoll ist, müssen einige Annahmen gelten. Diese leiten wir hier nicht her, verweisen aber auf entweder euer Statistikwissen/ Nachschlagewerk oder: https://www.youtube.com/watch?v=RRIsBFW8ovc (2-sample test) oder https://www.youtube.com/watch?v=MCmZ-HXSZ4A (chi2 Test)
- mögliche Fragen:
  
  *Community Perspektive*
  - mehr durchschnittliche Teilnehmer pro Event? (Länder im Vgl)
  
  *Advocacy Perspektive*
  - Unterscheiden sich die Anteile der Firmen/Plastik der top3 signifikant voneinander?
  
https://github.com/allisonhorst/bren-phd-workshop-r-materials/blob/master/day_6_r_materials/day_6_key.Rmd


### Resourcen ZUsammenfassung

- r4ds
- https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/