---
title: "Inhaltsverzeichnis"
author:
output: 
  learnr::tutorial:
    includes:
      after_body: ./www/favicon.html
    language: de
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
# remotes::install_github("rstudio/learnr")
# remotes::install_github("rstudio/gradethis")
library(gradethis)
library(learnr)
library(rio)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(janitor)
library(countrycode)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
gradethis::gradethis_setup(pass = "Gut gemacht!", 
                           fail = "Das ist leider nicht ganz richtig. Probiert es nochmal!",
                           code_correct = "Gut gemacht!", 
                           code_incorrect = "Das ist leider nicht ganz richtig. Probiert es nochmal!",
                           maybe_code_feedback = FALSE,
                           fail.hint = FALSE,
                           grading_problem.message = "Hups. Ist hier Code zur Überprüfung? Wenn ja, dann liegt der Fehler bei uns. Schickt Nina bitte einen Screenshot mit der Übung und Eurer Lösung."
                           )
``` 

```{r daten, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
### Daten laden
plastics <- rio::import('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-01-26/plastics.csv')

# Daten der World Bank mit R-Package ziehen
wb_areas <- WDI::WDI(
  country = "all", # Auswahl der Länder
  indicator = "ER.PTD.TOTL.ZS",  # Spezifikation des Indikators (Tipp: siehe Link in der Datenbank)
  start = 2018, # Auswahl Zeithorizont: Anfang
  end = 2018, # Auswahl Zeithorizont: Ende
  language = "en" #Sprachauswahl
) 

# Einlesen der Shapefiles
polygons_welt <- sf::st_read(here::here("daten/geospatial/ne_50m_admin_0_countries.shp"))
polygons_deutschland <- sf::st_read(here::here("daten/geospatial/1000_NUTS1.shp"))

### Daten bereinigen
# Country name cleaning: 
  # United Kingdom of Great Britain & Northern Ireland sowie für die USA
plastics_prep <- plastics %>%
  # nur 2019 weil 2020 wegen der Pandemie ein nicht repräsentatives Jahr ist
  filter(year==2019) %>%
  mutate(country = str_replace(country, "United Kingdom of Great Britain & Northern Ireland", "United Kingdom"),
         country = str_replace(country, "United States of America", "United States"),
         country = str_to_title(country) ) %>% #um z.B.: ECUADOR etc case ändern
  #Continent und Country Code anspielen
  mutate(continent = countrycode::countrycode(country, origin = "country.name", destination = "continent"),
         countrycode = countrycode::countrycode(country, origin = "country.name", destination = "iso3c")) %>%
  mutate(continent=replace_na(continent, "Unknown"),
         countrycode=replace_na(countrycode, "Unknown"))

### Community Datensatz erstellen
community<- plastics_prep %>%
  select(country, year, num_events, volunteers, grand_total, continent, countrycode) %>%
  group_by(country, year) %>%
  filter(row_number()==1)

# Audit Plastik Datensatz erstellen
audit_plastic<- plastics_prep %>%
  # nur grandtotal zeile behalten
  filter(parent_company=="Grand Total") %>%
  select(-c(parent_company, num_events, volunteers, empty)) %>%
  #NA zu 0
  mutate(
    across(everything(), ~replace_na(.x, 0))
  )

# EU-Asien Audit Plastik Datensatz erstellen
audit_plastic_eu_asia<- audit_plastic %>%
  filter(continent == "Europe" | continent == "Asia") %>%
  group_by(country) %>%
  mutate(n_types=sum(c(hdpe, ldpe, o, pet, pp, ps, pvc)!=0))
```

```{r results='asis'}
out <- knitr::knit_child("00_intro.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("01_datenprojekte.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("02_datenstrategie.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("03_datenschutz.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("04_rstudio.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("05_Erste_Analysen.Rmd", quiet = TRUE)
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("06_datenimport_NH.Rmd", quiet = TRUE) 
cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("06_datenimport_exkurssql.Rmd", quiet = TRUE) 
cat(out, sep = '')
```

## Datenbereinigung
```{r results='asis'}
#out <- knitr::knit_child("07_datenbereinigung.Rmd", quiet = TRUE)
#cat(out, sep = '')
```

## Reports
```{r results='asis'}
#out <- knitr::knit_child("08_Reports", quiet = TRUE)
#cat(out, sep = '')
```

## Reportautomatisierungen
```{r results='asis'}
#out <- knitr::knit_child("09_AutomatisierteReports", quiet = TRUE)
#cat(out, sep = '')
```

## Datenvisualisierung
```{r results='asis'}
# out <- knitr::knit_child("10_Shiny1", quiet = TRUE)
# cat(out, sep = '')
```

## Interaktive Visualisierungen
```{r results='asis'}
#out <- knitr::knit_child("11_Shiny2", quiet = TRUE)
#cat(out, sep = '')
```

## Und jetzt?
```{r results='asis'}
#out <- knitr::knit_child("12_closing.Rmd", quiet = TRUE)
#cat(out, sep = '')
```

```{r results='asis'}
out <- knitr::knit_child("99_glossar.Rmd", quiet = TRUE)
cat(out, sep = '')
```
