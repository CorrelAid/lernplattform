---
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Notwendige Packages laden
pacman::p_load(
  glue,
  here,
  lubridate,
  rmarkdown,
  tidyverse
  )
```

# Willkommen in der Report Fabrik

<!-- Anleitung einf√ºgen -->

# Schritt 1: rmarkdown::render() Funktion

Rendert ein .Rmd Eurer Wahl mit der `rmarkdown::render()` Funktion, anstatt des üß∂ Knit-Buttons. Ihr k√∂nnt den Code daf√ºr in diesem Dokument sammeln. Hier ist also Eure Report-Factory, in der ihr den Code schreibt, der dann die Reports generiert. 

*\*Anmerkung: Falls Ihr die render Funktion nachschlagen m√∂chtet, k√∂nnt Ihr den Namen der Funktion entweder im Help-Abschnitt von R-Studio eingeben oder die Funktion im Script highlighten und dann F1 dr√ºcken. Ein weiterer Weg ist es, `?render` in der Console auszuf√ºhren*

```{r}
# hier dein Code um einen Report mit rmarkdown::render() zu generieren
# Bsp: rmarkdown::render(input = "09_Reportautomatisierung_Report.Rmd")
```


## Schritt 2:  Output Datei umbenennen

Probiert Euch nun an dem `output_file` argument der Render Funktion:  
- setzt dort den Namen fest, den Eurer Report sp√§ter haben soll
```{r}
rmarkdown::render(
  input = "09_Reportautomatisierung_Report.Rmd",
  output_file = "2021-11-26_Plastik-Report_LR"
  )
```


# Schritt 3: Input vom Code trennen

Automatisiere die Erstellung des Output Namens deines Reports mit Hilfe der `glue::glue()` Funktion. √úberlege dir welche Teile deines Report-Namens sich eventuell oft √§ndern k√∂nnen (zum Beispiel das Datum). 

Passt den untenstehenden Code an, damit er mit Euren Reports funktioniert.

## Input Definition
```{r define-input}
set_rmd_name <- "09_Reportautomatisierung_Report.Rmd"

# Einzelteile des Report Namens
set_date <- lubridate::today()
set_report_name <- "Plastik-Report"
```

## Dokumentnamen bauen
```{r build-document-name}
output_file_name <- glue::glue("{set_date}_{set_report_name}")
```


Generiere nun einen Report mit automatisierter Benennung, den du in der Input-Abschnitt der Report-Factory festgelegt hast:

```{r}
rmarkdown::render(
  input = here::here(set_rmd_name),
  output_file = output_file_name
  )
```

# Schritt 4: YAML Optionen √§ndern 

Nun geht es weiter mit dem `output_format` argument. K√∂nnt ihr den untenstehenden Code so anpassen, dass ein PDF Dokument anstatt einer Website generiert wird?  

*\*Anmerkung: Falls Ihr die render Funktion nachschlagen m√∂chtet, k√∂nnt Ihr den Namen der Funktion entweder im Help-Abschnitt von R-Studio eingeben oder die Funktion im Script highlighten und dann F1 dr√ºcken. Ein weiterer Weg ist es, `?render` in der Console auszuf√ºhren*

```{r}
rmarkdown::render(
  input = set_rmd_name,
  output_file = output_file,
  output_format = "html_document"
)
```


# Schritt 5: Parameter kennenlernen

Schaue in den Beispiel Report `09_Reportautomatisierung_Report.Rmd` und finde die Stelle, an der die Parameter definiert werden. 

Welche Parameter Keys k√∂nnt Ihr dort entdecken? 

*\*Anmerkung: Erinnert Euch, Parameter bestehen immer aus Key: Value Paaren - √ºbersetzt Schl√ºssel: Wert Paaren. Dabei steht der Schl√ºssel vor dem Doppelpunkt und der Wert folgt danach.*

# Schritt 6: Parameter nutzen

F√ºhrt die Folgenden beiden Code Chunks aus und vergleicht die erstellten Reports. 
K√∂nnt ihr die Stelle im Code finden, die zu dem Unterschied gef√ºhrt habt? Findet ihr auch die Stelle im R Markdown Report Dokument, der zu dem Ergebnis beigetragen
```{r}
rmarkdown::render(
  input = here::here("uebungen/09_Reportautomatisierung_Report.Rmd"),
  output_file = "√úbungsreport-Europe-kein_Code",
  output_format = c("html_document"),
  output_dir = here::here("reports/"),
  params = list(highlight_continent = "Europe",
                include_code = FALSE)
  )
```


```{r}
rmarkdown::render(
  input = here::here("uebungen/09_Reportautomatisierung_Report.Rmd"),
  output_file = "√úbungsreport-Europe-mit_Code",
  output_format = c("html_document"),
  output_dir = here::here("reports/"),
  params = list(highlight_continent = "Europe",
                include_code = TRUE)
  )
```


Highlight in Report einf√ºgen (Europe)

Beispiel Highlight Abschnitt in Report einf√ºgen
---
params:
  highlight_continent: "Europe"
---


### Szenario 1:

# Schritt x: Parameter setzen

<!-- Im Folgenden nutzen wir den bisher erstellten Report. In dieser √úbung geht es darum, Parameter in diesem Report zu definieren und in den Report einzuf√ºgen. Damit erreichen wir, dass wir bestimmte Verhaltensweisen durch die Parameter automatisiert ver√§ndern k√∂nnen, ohne im Dokument selbst etwas √§ndern zu m√ºssen. Denn daf√ºr haben wir die Parameter als Platzhalter dienen. -->

F√ºge einen neuen Parameter im YAML-Abschnitt


# Final Code aus Video

```{r define-input}
set_rmd_name <- "plastic_report.Rmd"

# Einzelteile des Output Namens
set_date <- lubridate::today()
set_author <- "LR"
set_report_name <- "Plastik-Report"
set_hl <- "Asia"

# Dokumentnamen bauen
output_file_name <- glue::glue("{set_date}_{set_report_name}_hl-{set_hl}")
```


# einen Report generieren
```{r}
rmarkdown::render(
  input = set_rmd_name,
  output_file = output_file_name,
  output_format = "html_document",
  params = list(highlight_continent = set_hl)
  )
```

# mehrere Reports generieren

Kontinente extrahieren
```{r}
continent_names <- plastics_prep %>% 
  dplyr::distinct(continent) %>% 
  dplyr::pull(continent)
```


```{r}
purrr::walk(
  .x = continent_names,
  .f = ~ rmarkdown::render(
    input = here::here(set_rmd_name),
    output_file = glue::glue("{set_date}_{set_report_name}_hl-{.x}"),
    output_format = "pdf_document",
    params = list(highlight_continent = .x)
  )
)
```