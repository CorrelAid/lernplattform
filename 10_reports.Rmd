---
output:
  word_document: default
  html_document: default
---

## **Reports in R Markdown**

![*Video: Reports in RMarkdown (45min)*](https://youtu.be/VUQseeP65t8)

### **Kernaussagen**

-   R Markdown ist ein **Framework**, das es erm√∂glicht, **reproduzierbare Reports** mit R Code zu schreiben\

-   R Markdown ist so beliebt, weil es erm√∂glicht **alle Schritte einer Datenanalyse an einem Ort** zu sammeln:

    -   Einleitung und Fragestellung (Text)\
    -   Daten importieren, bereinigen & analysieren (Code)\
    -   Ergebnisse darstellen (Code Output)\
    -   Ergebnisse interpretieren (Text)\
    -   Zusammenfassung (Text)\

-   Mit **Code, Code Output (z.B. Tabellen oder Plots) und formatierbarem Text** an einem Ort wird es leichter, anderen Menschen die eigene Arbeit zu vermitteln, aber auch Ihr Selbst werdet Euch √ºber Anmerkungen und Erkl√§rungen zu Eurer Analyse freuen, wenn Ihr nach einiger Zeit zu der Datei zur√ºckkehrt\

-   Die **Code Chunks**, in den Code steht und die Code Output erzeugen, sind in Rmds **grau** hinterlegt, w√§hrend der **Markdown-Teil wei√ü** hinterlegt ist

-   In den formatierten Text Eures Reports k√∂nnt Ihr au√üerdem **berechnete Kennzahlen** integrieren, die bei der Aktualisierung der Daten wie der restliche Code Output automatisch geupdatet werden

-   Zudem ist es durch R Markdown leichter Eure Reports auf vielf√§ltige Art und Weise mit anderen zu **teilen**: Der Export in PDFs, HTML und Word ist m√∂glich\

-   Wenn Ihr **statische Reports** erstellen wollt, ist das PDF die richtige Wahl, f√ºr mehr Optionen ist eine **HTML**-Datei, die auch im Browser ge√∂ffnet werden kann, besser geeignet

-   R-Studio bietet eine sehr gute [**Hilfeseite**](https://rmarkdown.rstudio.com/lesson-1.html){target="_blank"} zu vielen Themen rund um R Markdown in englischer Sprache an - unter anderem ein tolles Einf√ºhrungsvideo (1min)\

-   Daneben gibt es auch noch diesen [**Schummelzettel (dt.)**](https://correlaid.org/material/Schummelblatt_rmarkdown.pdf){target="_blank"}, diesen [**Schummelzettel (engl.)**](https://github.com/rstudio/cheatsheets/raw/main/rmarkdown-2.0.pdf){target="_blank"} und dieses tolle [**Nachschlagewerk (engl.)**](https://correlaid.org/material/RMarkdownGuideline.pdf){target="_blank"}

### **Quiz**

```{r 10quiz_reports_allg}
quiz(caption = NULL,
  question("Welche diese Beschreibungen treffen zu? R Markdown ist... ",
    answer("...üì¶ ein R-Paket namens rmarkdown.", correct = TRUE),
    answer("...Ô∏èZauberei üßô"),
    answer("...ein Dateiformat zum Erstellen dynamischer Dokumente mit R.", correct = TRUE),
    answer("...ein Tool zum Integrieren von Prosa, Code und Ergebnissen.", correct = TRUE),
    correct = "Richtig!",
    incorrect = "Leider falsch: Versuche es einfach nochmal oder schau im Video nach!",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"),
  question("Die drei Hauptkomponenten, aus denen sich R Markdown Dateien zusammensetzen, sind:",
    answer("YAML Abschnitt, Inhalt und Code Chunks", correct = TRUE),
    answer("√úberschriften, Texte und Bilder"),
    answer("Code, Tabellen und Grafiken"),
    answer("R, Mark und Down"),
    correct = "Richtig!",
    incorrect = "Leider falsch: Versuche es einfach nochmal oder schau im Video nach!",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"
  )
)
```

### **Interaktive √úbung**

#### 1. Markdown (Inhalt)

In R Markdown Dateien steht das **md** in der Dateiendung `meine_datei.Rmd` f√ºr **Markdown.** Markdown (ohne R) ist eine einfache M√∂glichkeit, Text zu formatieren, der auf jedem Ger√§t gut aussieht. Auch unsere Lernplattform basiert auf Markdown. Alle √úberschriften, Text in *italics* oder **bold**, das Einf√ºgen von Bildern und Links funktioniert √ºber Markdown.

Die Formatierung funktioniert nur dem **wei√ü hinterlegten Teil** des Rmds, dem Textteil. Mit wenigen Zeichen k√∂nnt Ihr dort folgende Formatierungen vornehmen:

**H5 √úberschrift**

erstellt mit: `##### H5 √úberschrift`

*Anmerkung: H1 √úberschriften ben√∂tigen nur ein \#, H2 zwei \#\#, usw.*

------------------------------------------------------------------------

**Trennlinie**

erstellt mit: `---`

*Anmerkung: auf ausreichend Zeilenumbr√ºche davor und danach achten, h√§ufige Fehlerquelle.*

------------------------------------------------------------------------

**Text**

-   `*Text in italics*` wird zu *Text in italics*
-   `**Text in bold**` wird zu **Text in bold**

------------------------------------------------------------------------

**Einf√ºgen eines Bildes**

erstellt mit: `![Bildbeschriftung](Link zum Bild){width=10% height=10%}`

![Bild: Logo CorrelAid](https://betterplace-assets.betterplace.org/uploads/organisation/profile_picture/000/033/251/crop_original_bp1613490681_Logo.jpg){width="10%" height="10%"}

------------------------------------------------------------------------

**Einf√ºgen eines Hyperlinks**

erstellt mit: `[Hyperlinkname](Link){target="_blank"}`

[Hyperlink: Webseite CorrelAid](https://correlaid.org/){target="_blank"}

*Anmerkung: Mit {target="\_blank"} k√∂nnt Ihr festlegen, dass ein neuer Tab ge√∂ffnet wird.*

------------------------------------------------------------------------

**Zeilenumbr√ºche**

Praktisch sind auch **Umbr√ºche**, die mit "\<br\>" eingef√ºgt werden. Diese Notation stammt √ºbrigens aus HTML - ebenso praktisch sind die Notationen "\<center\>", "\<left\>" und "\<right\>" zur **Positionierung**. <br>

Soll Rmd diese mit Bedeutung belegten Sonderzeichen mal ignorieren, k√∂nnt Ihr vor sie einen **Backslash** `\` einf√ºgen.

```{r 10quiz_reports_markdown}
quiz(caption = NULL,
  question("Wie formatiert Ihr Text zu einer √úberschrift?",
    answer("Der gew√ºnschten Anzahl an Hashes (#), eins f√ºr H1, zwei f√ºr H2, ...", correct = TRUE),
    answer("Zwei Sternchen (**) vor und hinter der √úberschrift"),
    answer("Ein Sternchen (*) vor und hinter der √úberschrift"),
    answer("Einen Backslash vor und hinter der √úberschrift"),
    answer("Durch das Umschlie√üen der √úberschrift mit eckigen Klammern ([])"),
    correct = "Richtig!",
    incorrect = "Leider falsch: Versuche es einfach nochmal!",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"
  )
)
```

Wenn Ihr noch ein bisschen √ºben wollt, wie Ihr Text mit Hilfe von der Markdown Syntax formatieren k√∂nnt, gibt es hier ein [10-minutes interaktives Tutorial in englischer Sprache](https://commonmark.org/help/), welches wir sehr empfehlen k√∂nnen.

#### 2. R Code Bl√∂cke (Chunks)

Code Bl√∂cke werden in Eurem Rmd's **grau hinterlegt**. Ihr k√∂nnt sie mit

-   der Tastenkombination Strg + Alt + I (OS X: Cmd + Wahl + I) oder
-   dem Befehl `Chunk hinzuf√ºgen` in der Symbolleiste des Editors (gr√ºnes C+)

in Eure Rmd-Datei einf√ºgen.

Je nachdem wie Ihr Euer Rmd gestalten wollt, m√ºsst Ihr die Code Block **Argumente** setzen. Dazu setzt Ihr im Code Chunk innerhalb der geschwungenen Klammer ein Argument und erg√§nzt dann auf der rechten Seite die richtige Einstellung. Mehrere Argumente werden durch Kommata (",") getrennt. <br>

\`\`\`{r, argument1 = gew√ºnschte_einstellung, ...} <br> Dein Code hier <br> \`\`\` <br>

Grunds√§tzlich wird in Eurem Outputformat **aller Code, s√§mtlicher Code Output, alle Nachrichten und Warnungen** integriert. Nicht immer ist das gew√ºnscht. Die wichtigsten Argumente findet Ihr deshalb hier:

-   `include = FALSE` definiert, dass **Code und Code Output** in der fertigen Datei **nicht erscheinen**. R Markdown f√ºhrt den Code weiterhin im Chunk aus und die Ergebnisse k√∂nnen von anderen Chunks verwendet werden.
-   `echo = FALSE` definiert, dass **Code nicht angezeigt wird**, aber Code Output (wie Tabellen und Plots) in der fertigen Datei erscheinen. Dies ist eine n√ºtzliche Methode zum **Einbetten von Abbildungen**.
-   `message = FALSE` verhindert, dass **Nachrichten**, die bei der Ausf√ºhrung des Codes generiert werden, in der fertigen Datei erscheinen.
-   `warning = FALSE` verhindert, dass **Warnungen**, die bei der Ausf√ºhrung des Codes generiert werden, im Report erscheinen.
-   `fig.cap = "..."` f√ºgt den grafischen Ergebnissen eine **Beschriftung** hinzu.

Um eine Option f√ºr alle Code Blocks festzulegen, kann sie **global im ersten Setup Code Block** mit der Funktion `knitr::opts_chunk$set(argument = ...)` gesetzt werden. <br>

\`\`\`{r setup, include=FALSE} <br> knitr::opts_chunk\$set(argument1 = gew√ºnschte_einstellung, ...) <br> \`\`\` <br>

Knitr behandelt jede Option, die an knitr::opts_chunk\$set √ºbergeben wurde, als globalen Standard, der **in einzelnen Chunk-Headern √ºberschrieben** werden kann.

```{r 10quiz_reports_codechunksettings, echo=FALSE, message=FALSE, warning=FALSE}
quiz(caption = NULL,
  question("Grunds√§tzlich m√∂chtet Ihr nicht, dass Code, Nachrichten und Warnungen in Eurem PDF-Outputformat angezeigt werden (also nur der Output sichtbar ist). Was m√ºsst Ihr tun?",
    answer("Im Set-Up Chunk setzen wir die Argumente include, echo, message und warning auf FALSE"),
    answer("Im Set-Up Chunk setzen wir die Argumente echo, message und warning auf FALSE", correct = TRUE),
    answer("Im Set-Up Chunk setzen wir die Argumente include, echo, message und warning auf TRUE"),
    answer("Im Code-Chunk setzen wir die Argumente echo, message und warning auf FALSE"),
    correct = "Richtig! Die Argumente setzen wir dann innerhalb der Funktion knitr::opts_chunk$set().",
    incorrect = "Leider falsch: F√ºr globale Einstellungen nutzen wir den Set-Up-Chunk und definieren innerhalb von knitr::opts_chunk$set() die Argumente wie gew√ºnscht. Hier sind das echo, message und warning, die alle auf FALSE gesetzt werden m√ºssen.",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"
  ),
  question("Ausnahmsweise soll nun einmal der Code gezeigt werden. Was m√ºsst Ihr tun?",
    answer("Im betroffenen Code Chunk setzen wir das Argument echo auf TRUE", correct = TRUE),
    answer("Im betroffenen Code Chunk setzen wir das Argument echo auf FALSE"),
    answer("Im betroffenen Code Chunk setzen wir das Argument include auf FALSE"),
    answer("Im betroffenen Code Chunk setzen wir das Argument include auf TRUE"),
    correct = "Richtig!",
    incorrect = "Leider falsch: Wir m√ºssen das Argument echo muss auf TRUE gestellt werden. Mit dem Argument include wird √ºbrigens definiert, ob Code und Code Output in das Outputdokument integriert werden sollen. Dieses muss auf TRUE gestellt werden, wenn das geschehen soll, und auf auf FALSE, wenn es nicht geschehen soll.",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"
  )
)
```

#### 3. YAML Kopfzeile

In der YAML Kopfzeile k√∂nnen verschiedene Meta-Parameter festgelegt werden, die f√ºr die Verarbeitung der R Markdown Datei wichtig sind.

Der YAML Abschnitt ist f√ºr gew√∂hnlich ganz oben in R Markdown Dateien zu finden und daran zu erkennen, dass er mit `---` umschlossen ist:

    ---
    title: "Euer Titel"
    date: "Datum"
    output: html_document
    ---

Die **Grundeinstellungen** geben Titel, Autor:in, Datum und Outputformat des geknitteten Dokuments an. Dar√ºber hinaus gibt es aber noch mehr M√∂glichkeiten. So k√∂nnt Ihr dort beispielsweise das Layoutformat anpassen. Wenn Ihr Euch mit HTML und CSS auskennt, k√∂nnt Ihr sogenannte Stylesheets anlegen und auf diese verweisen. Die leichteste Option ist es allerdings vorgefertigte Themes zu nutzen.

Im untenstehenden YAML Code wird eimes der Standard Themes von R Markdown namens "Flatly" definiert. Weitere Themes findest du in dieser [R Markdown Theme Gallery](https://www.datadreaming.org/post/r-markdown-theme-gallery/){target="_blank"}.

    ---
    title: "Euer Titel"
    date: "Datum"
    output: 
      html_document:
        theme: "flatly"
        highlight: github
    ---

```{r 10quiz_reports_yaml}
quiz(caption = NULL,
  question("Im YAML-Header k√∂nnen welche Einstellungen getroffen werden?",
    answer("Titel des Outputdokuments", correct = TRUE),
    answer("Autor:in des Outputdokuments", correct = TRUE),
    answer("Datum des Outputdokuments", correct = TRUE),
    answer("Dateiformat", correct = TRUE),
    answer("Layout", correct = TRUE),
    answer("...und vieles mehr!", correct = TRUE),
    correct = "Richtig! Der YAML-Header √ºbernimmt in Rmds zahlreiche Funktionen rund um Styling und Layout.",
    incorrect = "Leider falsch: Alles davon kann im YAML-Header festgelegt werden!",
    allow_retry = TRUE,
    try_again_button = "Nochmal versuchen"
  )
)
```

### **Und jetzt Ihr**

1.  **Lasst Euch inspirieren**: Besucht die [R-Studio R Markdown Galerie](https://rmarkdown.rstudio.com/gallery.html){target="_blank"} und st√∂bert durch einige Beispiele, die mit R Markdown erstellt wurden. Ihr k√∂nnt zwischen Webseiten, PDF-Dokumenten oder Dashboards, Slideshows uvm. w√§hlen. Teilt Euer Lieblingsbeispiel (als Screenshot und/oder mit Link) im Slack Channel und beschreibt in 1-3 S√§tzen, was Ihr an dem Report besonders gelungen findet.
2.  Bearbeitet lokal die [√úbung 10_Reports](https://drive.google.com/drive/folders/1vguUDzT0oO6XNmNsMqt6Uw_xn5Vkin2C?usp=share_link){target="_blank"} zu R Markdown, die wir f√ºr Euch vorbereitet haben.

### **Zus√§tzliche Ressourcen**

-   [**Schummelzettel (dt.)**](https://correlaid.org/material/Schummelblatt_rmarkdown.pdf){target="_blank"}
-   [**Nachschlagewerk zu RMarkdown (engl.)**](https://correlaid.org/material/RMarkdownGuideline.pdf){target="_blank"}
-   R-Studio bietet eine sehr gute [**Hilfeseite**](https://rmarkdown.rstudio.com/lesson-1.html){target="_blank"}
-   Templates f√ºr [PDF- und HTML-Dokumente](https://www.rstudio.com/blog/r-markdown-custom-formats/){target="_blank"}
